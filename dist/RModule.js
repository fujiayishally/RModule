!function(t,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?module.exports=n():t.RModule=n()}(this,function(){var r,i,a,l;location.origin||(location.origin=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")),Object.keys||(Object.keys=(r=Object.prototype.hasOwnProperty,i=!{toString:null}.propertyIsEnumerable("toString"),l=(a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(t){if("object"!=typeof t&&"function"!=typeof t||null===t)throw new TypeError("Object.keys called on non-object");var n=[];for(var e in t)r.call(t,e)&&n.push(e);if(i)for(var o=0;o<l;o++)r.call(t,a[o])&&n.push(a[o]);return n})),"function"!=typeof Array.prototype.indexOf&&(Array.prototype.indexOf=function(t){for(var n=0,e=this.length;n<e;n++)if(this[n]===t)return n;return-1});var s=function(t){return"string"==typeof t},f=function(t){return t instanceof Array},u=function(t){return"function"==typeof t},c=function(t){return t instanceof Object},p=function(t,n){throw t+":"+n},h=function(t,n){console.warn(t+":"+n)},y={},d=[],g=[],n=[],t=location.origin,b="模块引用有误",v="别名引用有误",O="参数有误",m={ModuleDupli:"模块已存在",CallDupli:"重复调用"};function e(){this.$origin=t,this.$base="",this.$alias={},this.$modules=y}return function(t){var r=!1;function i(t){var n,e,o,r,i=t;if(/^(http|https):\/\//.test(i))return i;for(n=(n=this.$base.replace(/\/$/,"")).split(/\b\/\b/),i=i.replace(/^(\/|\.\/)/,"");/^\.\.\//.test(i);){if(n.length<=1){p(b,'路径"'+t+'"不正确！');break}n.pop(),i=i.replace(/^\.\.\//,"")}if(!/(\.\/|\.\.\/)/.test(i)){for(e=0,o=(i=i.split("/")).length;e<o;e++)if(r=i[e],/^@/.test(r)){if(r=r.substring(1),!this.$alias.hasOwnProperty(r))return p(v,"别名@"+r+"尚未定义！");i[e]=this.$alias[r].replace(/\/$/,""),e--,o=(i=i.join("/").split("/")).length}return i=(i=n.concat(i)).join("/")}p(b,'路径"'+t+'"不正确！')}function a(t){var n,e,o;-1===d.indexOf(t)&&-1===g.indexOf(t)?((n=document.createElement("script")).src=t,n.onload=(o=this,function(){console.log("onload",t),l.call(o,t)}),n.onerror=(e=this,function(){l.call(e,t)}),document.getElementsByTagName("head")[0].appendChild(n),d.push(t)):h(m.ModuleDupli,"模块"+t+"已加载！")}function l(t){var n=d.indexOf(t);g.push(d[n]),d.splice(n,1),this.task()}t.prototype.config=function(t){if(r)return h(m.CallDupli,"config配置函数只能调用一次！");if(!c(t))return h(m.ParamInvali,"config配置函数的参数应该是一个对象！");if(t.base){if(!s(t.base))return h(m.ParamInvali,"base用于配置模块加载根路径，它应该是一段字符串！");this.$base=t.base}else this.$base=this.$origin;if(t.alias){if(!c(t.alias))return p(m.ParamInvali,"alias用于简化模块路径，它应该是一个简称-路径的键值对对象！");this.$alias=t.alias}else this.$alias={};var n,e,o=0;if(t.preload){if(!f(t.preload))return h(m.ParamInvali,"preload用于加载模块文件，它应该是一个存放模块路径的数组！");for(n=t.preload.length;o<n;o++)e=i.call(this,t.preload[o]),a.call(this,e)}r=!0}}(e),e.prototype.define=function(t,n,e){if(!t||!s(t))return p(O,"模块命名必须定义，类型为字符串！");if(f(n)||(e=n,n=[]),!u(e))return p(O,"请正确定义模块"+t+"!");if(y.hasOwnProperty(t))return h(m.ModuleDupli,t+"不能重复定义！");for(var o=0,r=n.length,i=null;o<r;o++)i=n[o],y.hasOwnProperty(i)||p(b,"依赖模块"+i+"不存在！"),n[o]=y[i]();y[t]=function(){return e.apply(e,n)}},e.prototype.get=function(t){var n=y[t];return n?n():p(b,t+"不存在！")},e.prototype.task=function(t){t&&(u(t)?n.push(t):p(O,"task的参数应该是一个定义任务的方法！")),function(){var t;if(0===Object.keys(d).length)for(;t=n.shift();)t()}()},new e});